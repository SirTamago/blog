(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Pjax=e()}})((function(){return function(){function e(t,o,n){function i(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[s]={exports:{}};t[s][0].call(u.exports,(function(e){var o=t[s][1][e];return i(o||e)}),u,u.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,o){var n=e("./lib/foreach-els");var i=e("./lib/parse-options");var r=e("./lib/switches");var s=e("./lib/uniqueid");var a=e("./lib/events/on");var l=e("./lib/events/trigger");var c=e("./lib/util/clone");var u=e("./lib/util/contains");var f=e("./lib/util/extend");var h=e("./lib/util/noop");var d=function(e){this.state={numPendingSwitches:0,href:null,options:null};this.options=i(e);this.log("Pjax options",this.options);if(this.options.scrollRestoration&&"scrollRestoration"in history){history.scrollRestoration="manual";a(window,"beforeunload",(function(){history.scrollRestoration="auto"}))}this.maxUid=this.lastUid=s();this.parseDOM(document);a(window,"popstate",function(e){if(e.state){var t=c(this.options);t.url=e.state.url;t.title=e.state.title;t.history=false;t.scrollPos=e.state.scrollPos;if(e.state.uid<this.lastUid){t.backward=true}else{t.forward=true}this.lastUid=e.state.uid;this.loadUrl(e.state.url,t)}}.bind(this))};d.switches=r;d.prototype={log:e("./lib/proto/log"),getElements:function(e){return e.querySelectorAll(this.options.elements)},parseDOM:function(t){var o=e("./lib/proto/parse-element");n(this.getElements(t),o,this)},refresh:function(e){this.parseDOM(e||document)},reload:function(){window.location.reload()},attachLink:e("./lib/proto/attach-link"),attachForm:e("./lib/proto/attach-form"),forEachSelectors:function(t,o,n){return e("./lib/foreach-selectors").bind(this)(this.options.selectors,t,o,n)},switchSelectors:function(t,o,n,i){var r=this.state;if(r.options.history){if(!window.history.state){this.lastUid=this.maxUid=s();window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)}this.lastUid=this.maxUid=s();window.history.pushState({url:r.href,title:r.options.title,uid:this.maxUid,scrollPos:[0,0]},r.options.title,r.href)}l(document,"pjax:start",i);return e("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,t,o,n,i)},latestChance:function(e){window.location=e},onSwitch:function(){l(window,"resize scroll");this.state.numPendingSwitches--;if(this.state.numPendingSwitches===0){this.afterAllSwitches()}},loadContent:function(e,t){if(typeof e!=="string"){l(document,"pjax:complete pjax:error",t);this.loadUrl("/404");return}var o=document.implementation.createHTMLDocument("pjax");var n=/<html[^>]+>/gi;var i=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;var r=e.match(n);if(r&&r.length){r=r[0].match(i);if(r.length){r.shift();r.forEach((function(e){var t=e.trim().split("=");if(t.length===1){o.documentElement.setAttribute(t[0],true)}else{o.documentElement.setAttribute(t[0],t[1].slice(1,-1))}}))}}o.documentElement.innerHTML=e;this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length);if(document.activeElement&&u(document,this.options.selectors,document.activeElement)){try{document.activeElement.blur()}catch(e){}}this.switchSelectors(this.options.selectors,o,document,t)},abortRequest:e("./lib/abort-request"),doRequest:e("./lib/send-request"),handleResponse:e("./lib/proto/handle-response"),loadUrl:function(e,t){t=typeof t==="object"?f({},this.options,t):c(this.options);this.log("load href",e,t);this.abortRequest(this.request);if(e!=="/404"){l(document,"pjax:send",t)}this.request=this.doRequest(e,t,this.handleResponse.bind(this))},executeScripts:function(e){e.forEach((function(e){var t=e.text||e.textContent||e.innerHTML||"";var o=document.createElement("script");if(e.id){o.id=e.id}if(e.className){o.className=e.className}if(e.type){o.type=e.type}if(e.src){o.src=e.src;o.async=false}if(e.dataset.pjax!==undefined){o.dataset.pjax=""}if(t!==""){o.appendChild(document.createTextNode(t))}e.parentNode.replaceChild(o,e)}))},afterAllSwitches:function(){var e=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();if(e&&document.activeElement!==e){e.focus()}this.options.selectors.forEach((function(e){n(document.querySelectorAll(e),(function(e){if(e===0);}))}));this.forEachSelectors((function(e){this.parseDOM(e)}),this);var t=this.state;l(document,"pjax:complete pjax:success",t.options);if(typeof t.options.analytics==="function"){t.options.analytics()}if(t.options.history){var o=document.createElement("a");o.href=this.state.href;if(o.hash){var i=o.hash.slice(1);i=decodeURIComponent(i);var r=0;var s=document.getElementById(i)||document.getElementsByName(i)[0];if(s){if(s.offsetParent){do{r+=s.offsetTop;s=s.offsetParent}while(s)}}window.scrollTo(0,r)}else if(t.options.scrollTo!==false){if(t.options.scrollTo.length>1){window.scrollTo(t.options.scrollTo[0],t.options.scrollTo[1])}else{window.scrollTo(0,t.options.scrollTo)}}}else if(t.options.scrollRestoration&&t.options.scrollPos){window.scrollTo(t.options.scrollPos[0],t.options.scrollPos[1])}this.state={numPendingSwitches:0,href:null,options:null}}};d.isSupported=e("./lib/is-supported");if(d.isSupported()){t.exports=d}else{var p=h;for(var m in d.prototype){if(d.prototype.hasOwnProperty(m)&&typeof d.prototype[m]==="function"){p[m]=h}}t.exports=p}},{"./lib/abort-request":2,"./lib/events/on":3,"./lib/events/trigger":4,"./lib/foreach-els":5,"./lib/foreach-selectors":6,"./lib/is-supported":7,"./lib/parse-options":8,"./lib/proto/attach-form":9,"./lib/proto/attach-link":10,"./lib/proto/handle-response":11,"./lib/proto/log":12,"./lib/proto/parse-element":13,"./lib/send-request":14,"./lib/switches":16,"./lib/switches-selectors":15,"./lib/uniqueid":17,"./lib/util/clone":18,"./lib/util/contains":19,"./lib/util/extend":20,"./lib/util/noop":21}],2:[function(e,t,o){var n=e("./util/noop");t.exports=function(e){if(e&&e.readyState<4){e.onreadystatechange=n;e.abort()}}},{"./util/noop":21}],3:[function(e,t,o){var n=e("../foreach-els");t.exports=function(e,t,o,i){t=typeof t==="string"?t.split(" "):t;t.forEach((function(t){n(e,(function(e){e.addEventListener(t,o,i)}))}))}},{"../foreach-els":5}],4:[function(e,t,o){var n=e("../foreach-els");t.exports=function(e,t,o){t=typeof t==="string"?t.split(" "):t;t.forEach((function(t){var i=new Event(t);i.eventName=t;if(o){Object.keys(o).forEach((function(e){i[e]=o[e]}))}n(e,(function(e){var t=false;if(!e.parentNode&&e!==document&&e!==window){t=true;document.body.appendChild(e)}e.dispatchEvent(i);if(t){e.parentNode.removeChild(e)}}))}))}},{"../foreach-els":5}],5:[function(e,t,o){t.exports=function(e,t,o){if(e instanceof HTMLCollection||e instanceof NodeList||e instanceof Array){return Array.prototype.forEach.call(e,t,o)}return t.call(o,e)}},{}],6:[function(e,t,o){var n=e("./foreach-els");t.exports=function(e,t,o,i){i=i||document;e.forEach((function(e){n(i.querySelectorAll(e),t,o)}))}},{"./foreach-els":5}],7:[function(e,t,o){t.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],8:[function(e,t,o){var n=e("./switches");t.exports=function(e){e=e||{};e.elements=e.elements||"a[href], form[action]";e.selectors=e.selectors||["title",".js-Pjax"];e.switches=e.switches||{};e.switchesOptions=e.switchesOptions||{};e.history=typeof e.history==="undefined"?true:e.history;e.analytics=typeof e.analytics==="function"||e.analytics===false?e.analytics:i;e.scrollTo=typeof e.scrollTo==="undefined"?0:e.scrollTo;e.scrollRestoration=typeof e.scrollRestoration!=="undefined"?e.scrollRestoration:true;e.cacheBust=typeof e.cacheBust==="undefined"?true:e.cacheBust;e.debug=e.debug||false;e.timeout=e.timeout||0;e.currentUrlFullReload=typeof e.currentUrlFullReload==="undefined"?false:e.currentUrlFullReload;if(!e.switches.head){e.switches.head=n.switchElementsAlt}if(!e.switches.body){e.switches.body=n.switchElementsAlt}return e};function i(){if(window._gaq){_gaq.push(["_trackPageview"])}if(window.ga){ga("send","pageview",{page:location.pathname,title:document.title})}}},{"./switches":16}],9:[function(e,t,o){var n=e("../events/on");var i=e("../util/clone");var r="data-pjax-state";var s=function(e,t){if(c(t)){return}var o=i(this.options);o.requestOptions={requestUrl:e.getAttribute("action")||window.location.href,requestMethod:e.getAttribute("method")||"GET"};var n=document.createElement("a");n.setAttribute("href",o.requestOptions.requestUrl);var s=l(n,o);if(s){e.setAttribute(r,s);return}t.preventDefault();if(e.enctype==="multipart/form-data"){o.requestOptions.formData=new FormData(e)}else{o.requestOptions.requestParams=a(e)}e.setAttribute(r,"submit");o.triggerElement=e;this.loadUrl(n.href,o)};function a(e){var t=[];var o=e.elements;for(var n=0;n<o.length;n++){var i=o[n];var r=i.tagName.toLowerCase();if(!!i.name&&i.attributes!==undefined&&r!=="button"){var s=i.attributes.type;if(!s||s.value!=="checkbox"&&s.value!=="radio"||i.checked){var a=[];if(r==="select"){var l;for(var c=0;c<i.options.length;c++){l=i.options[c];if(l.selected&&!l.disabled){a.push(l.hasAttribute("value")?l.value:l.text)}}}else{a.push(i.value)}for(var u=0;u<a.length;u++){t.push({name:encodeURIComponent(i.name),value:encodeURIComponent(a[u])})}}}}return t}function l(e,t){if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}if(t.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){return"reload"}}var c=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(e){var t=this;e.setAttribute(r,"");n(e,"submit",(function(o){s.call(t,e,o)}))}},{"../events/on":3,"../util/clone":18}],10:[function(e,t,o){var n=e("../events/on");var i=e("../util/clone");var r="data-pjax-state";var s=function(e,t){if(l(t)){return}var o=i(this.options);var n=a(e,t);if(n){e.setAttribute(r,n);return}t.preventDefault();if(this.options.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){e.setAttribute(r,"reload");this.reload();return}e.setAttribute(r,"load");o.triggerElement=e;this.loadUrl(e.href,o)};function a(e,t){if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey){return"modifier"}if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}}var l=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(e){var t=this;e.setAttribute(r,"");n(e,"click",(function(o){s.call(t,e,o)}));n(e,"keyup",function(o){if(o.keyCode===13){s.call(t,e,o)}}.bind(this))}},{"../events/on":3,"../util/clone":18}],11:[function(e,t,o){var n=e("../util/clone");var i=e("../uniqueid");var r=e("../events/trigger");t.exports=function(e,t,o,s){s=n(s||this.options);s.request=t;if(e===false){r(document,"pjax:complete pjax:error",s);return}var a=window.history.state||{};window.history.replaceState({url:a.url||window.location.href,title:a.title||document.title,uid:a.uid||i(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var l=o;if(t.responseURL){if(o!==t.responseURL){o=t.responseURL}}else if(t.getResponseHeader("X-PJAX-URL")){o=t.getResponseHeader("X-PJAX-URL")}else if(t.getResponseHeader("X-XHR-Redirected-To")){o=t.getResponseHeader("X-XHR-Redirected-To")}var c=document.createElement("a");c.href=l;var u=c.hash;c.href=o;if(u&&!c.hash){c.hash=u;o=c.href}this.state.href=o;this.state.options=s;try{this.loadContent(e,s)}catch(e){r(document,"pjax:error",s);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",e)}return this.latestChance(o)}else{throw e}}}},{"../events/trigger":4,"../uniqueid":17,"../util/clone":18}],12:[function(e,t,o){t.exports=function(){if(this.options.debug&&console){if(typeof console.log==="function"){console.log.apply(console,arguments)}else if(console.log){console.log(arguments)}}}},{}],13:[function(e,t,o){var n="data-pjax-state";t.exports=function(e){switch(e.tagName.toLowerCase()){case"a":if(!e.hasAttribute(n)){this.attachLink(e)}break;case"form":if(!e.hasAttribute(n)){this.attachForm(e)}break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],14:[function(e,t,o){var n=e("./util/update-query-string");t.exports=function(e,t,o){t=t||{};var i;var r=t.requestOptions||{};var s=(r.requestMethod||"GET").toUpperCase();var a=r.requestParams||null;var l=r.formData||null;var c=null;var u=new XMLHttpRequest;var f=t.timeout||0;u.onreadystatechange=function(){if(u.readyState===4){if(u.status===200){o(u.responseText,u,e,t)}else if(u.status!==0){o(null,u,e,t)}}};if(e!=="/404"){u.onerror=function(n){console.log(n);o(null,u,e,t)}}else{u.onerror=function(e){console.log(e)}}u.ontimeout=function(){o(null,u,e,t)};if(a&&a.length){i=a.map((function(e){return e.name+"="+e.value})).join("&");switch(s){case"GET":e=e.split("?")[0];e+="?"+i;break;case"POST":c=i;break}}else if(l){c=l}if(t.cacheBust){e=n(e,"t",Date.now())}u.open(s,e,true);u.timeout=f;u.setRequestHeader("X-Requested-With","XMLHttpRequest");u.setRequestHeader("X-PJAX","true");u.setRequestHeader("X-PJAX-Selectors",JSON.stringify(t.selectors));if(c&&s==="POST"&&!l){u.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}u.send(c);return u}},{"./util/update-query-string":22}],15:[function(e,t,o){var n=e("./foreach-els");var i=e("./switches");t.exports=function(e,t,o,r,s,a){var l=[];o.forEach((function(o){var c=r.querySelectorAll(o);var u=s.querySelectorAll(o);if(this.log){this.log("Pjax switch",o,c,u)}if(c.length!==u.length){throw"DOM doesn’t look the same on new loaded page: ’"+o+"’ - new "+c.length+", old "+u.length}n(c,(function(n,r){var s=u[r];if(this.log){this.log("newEl",n,"oldEl",s)}var c=e[o]?e[o].bind(this,s,n,a,t[o]):i.outerHTML.bind(this,s,n,a);l.push(c)}),this)}),this);this.state.numPendingSwitches=l.length;l.forEach((function(e){e()}))}},{"./foreach-els":5,"./switches":16}],16:[function(e,t,o){var n=e("./events/on");t.exports={outerHTML:function(e,t){e.outerHTML=t.outerHTML;this.onSwitch()},innerHTML:function(e,t){e.innerHTML=t.innerHTML;if(t.className===""){e.removeAttribute("class")}else{e.className=t.className}this.onSwitch()},switchElementsAlt:function(e,t){e.innerHTML=t.innerHTML;if(t.hasAttributes()){var o=t.attributes;for(var n=0;n<o.length;n++){e.attributes.setNamedItem(o[n].cloneNode())}}this.onSwitch()},replaceNode:function(e,t){e.parentNode.replaceChild(t,e);this.onSwitch()},sideBySide:function(e,t,o,i){var r=[];var s=[];var a=document.createDocumentFragment();var l="animationend webkitAnimationEnd MSAnimationEnd oanimationend";var c=0;var u=function(e){if(e.target!==e.currentTarget){return}c--;if(c<=0&&r){r.forEach((function(e){if(e.parentNode){e.parentNode.removeChild(e)}}));s.forEach((function(e){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")}));s=null;r=null;this.onSwitch()}}.bind(this);i=i||{};e.childNodes.forEach((e=>{r.push(e);if(e.classList&&!e.classList.contains("js-Pjax-remove")){if(e.hasAttribute("data-pjax-classes")){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")}e.classList.add("js-Pjax-remove");if(i.callbacks&&i.callbacks.removeElement){i.callbacks.removeElement(e)}if(i.classNames){e.className+=" "+i.classNames.remove+" "+(o.backward?i.classNames.backward:i.classNames.forward)}c++;n(e,l,u,true)}}));Array.from(t.childNodes).forEach((function(e){if(e.classList){var t="";if(i.classNames){t=" js-Pjax-add "+i.classNames.add+" "+(o.backward?i.classNames.forward:i.classNames.backward)}if(i.callbacks&&i.callbacks.addElement){i.callbacks.addElement(e)}e.className+=t;e.setAttribute("data-pjax-classes",t);s.push(e);a.appendChild(e);c++;n(e,l,u,true)}}));e.className=t.className;e.appendChild(a)}}},{"./events/on":3}],17:[function(e,t,o){t.exports=function(){var e=0;return function(){var t="pjax"+(new Date).getTime()+"_"+e;e++;return t}}()},{}],18:[function(e,t,o){t.exports=function(e){if(null===e||"object"!==typeof e){return e}var t=e.constructor();for(var o in e){if(e.hasOwnProperty(o)){t[o]=e[o]}}return t}},{}],19:[function(e,t,o){t.exports=function e(t,o,n){for(var i=0;i<o.length;i++){var r=t.querySelectorAll(o[i]);for(var s=0;s<r.length;s++){if(r[s].contains(n)){return true}}}return false}},{}],20:[function(e,t,o){t.exports=function(e){if(e==null){return null}var t=Object(e);for(var o=1;o<arguments.length;o++){var n=arguments[o];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}}return t}},{}],21:[function(e,t,o){t.exports=function(){}},{}],22:[function(e,t,o){t.exports=function(e,t,o){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i");var i=e.indexOf("?")!==-1?"&":"?";if(e.match(n)){return e.replace(n,"$1"+t+"="+o+"$2")}else{return e+i+t+"="+o}}},{}]},{},[1])(1)}));